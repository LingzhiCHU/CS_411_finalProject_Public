require(["handlebars"],function(g){try{define("modernizr",function(){return window.Modernizr})}catch(m){}g.registerHelper("urgency_loc",function(m,c){var a=c.hash.bundle,a=void 0!==window.loc[a]?window.loc[a][m]:window.loc.messages[a+"_"+m];"function"!==typeof a&&-1<a.indexOf("{")&&(a=g.compile(a));"function"===typeof a&&(a=a(this));"fi_FI"===uitk.locale&&(a=a.replace("ebookersn","ebookersin"));return new g.SafeString(a)});g.registerHelper("urgency_if_eq",function(g,c,a){return g===c&&!a.hash.useDoubleEquals||g==c&&!0===a.hash.useDoubleEquals?a.fn(this):a.inverse(this)});g.registerHelper("block",function(m,c){var a=g.partials[m];"string"===typeof a&&(a=g.compile(a),g.partials[m]=a);return(a||c.fn)(this,{data:c.hash})});g.registerHelper("partial",function(m,c){g.registerPartial(m,c.fn)})});
(function(g,m){g||(window.urgency={});if("function"===typeof define&&define.amd)try{define("urgency/main",["jquery","uitk","dctk"],function(c,a,d){window.urgency.main=m(c,a,d);return window.urgency.main})}catch(c){}else window.urgency.main=m(window.jQuery,window.uitk,window.dctk)})(window.urgency,function(g,m,c){function a(a,c){return"undefined"===typeof a||"undefined"===typeof a.responseStatusCode||0!==a.responseStatusCode?!1:"function"===typeof c?c(a):!0}function d(a,c,e,k,f){var b;c=c.split(",");for(var l=0;l<c.length;l++)b=c[l],a.hasOwnProperty(b)&&a[b]&&(b=a[b],"function"===typeof b.responseValidator&&b.topic&&(b.responseValidator(e)?m.publish(b.topic,{status:h.statuscodes.SUCCESS_RESPONSE,response:"function"===typeof b.responseExtractor?b.responseExtractor(e):e,src:k,requestData:f}):m.publish(b.topic,{status:h.statuscodes.ERROR_RESPONSE,response:e,src:k,requestData:f})))}function q(a,c,e,k,f){var b,l;for(b in a)a.hasOwnProperty(b)&&a[b]&&(l=a[b],l.topic&&m.publish(l.topic,{status:k,response:c,src:e,requestData:f}))}var h={statuscodes:{AJAX_FAIL:"URGENCY_AJAX_FAIL",RESPONSE_PARSE_ERROR:"URGENCY_AJAX_RESPONSE_PARSE_ERROR",ERROR_RESPONSE:"ERROR",SUCCESS_RESPONSE:"SUCCESS",INVALID_INPUT:"INVALID_INPUT"},api:{flight:"FlightTickerApi",flightEndpoint:"//urgency.expedia.com/urgencyservice/v1/ticker/flight",flightTimeout:3E3,region:"RegionTickerApi",regionEndpoint:"//urgency.expedia.com/urgencyservice/v1/ticker/region",regionTimeout:3E3,hotel:"HotelTickerApi",hotelEndpoint:"//urgency.expedia.com/urgencyservice/v1/ticker/hotel",hotelTimeout:15E3,lastBooking:"LastBookingService Domain",lastBookingEndpoint:"/LastBooking/elapsedTime",hotelTestEndpoint:"//10.0.17.193:8080/urgencyservice/v1/ticker/hotel",lastBookingTimeout:3E3},utils:{objToStringArray:function(a,c,e){var b=[],f,l;if("object"===typeof a){c="string"===typeof c?c:"";e="number"===typeof e?e:50;for(f in a)a.hasOwnProperty(f)&&(l=a[f],"string"===typeof l||"number"===typeof l||"boolean"===typeof l?b.push((c+f+"\x3d"+l.toString().substring(0,e)).replace(/\.| /g,"")):null!==l&&"object"===typeof l&&(b=b.concat(this.objToStringArray(l,f+"-"))));return b}},ajaxRequest:function(a,l){var b=["api\x3d"+l],k=this,f=0;a=g.extend(!0,{dataType:"json",data:{},timeout:3E3,type:"GET"},a);b=b.concat(this.objToStringArray(a,"options-"));return g.ajax({cache:!1,data:a.data,dataType:a.dataType,type:a.type,url:a.url,timeout:a.timeout,beforeSend:function(){f=(new Date).getTime()}}).done(function(f,e,l){try{var d;b=b.concat(k.objToStringArray(l,"xhr-"));if("function"===typeof a.success){try{d="string"===typeof f?g.parseJSON(f):f}catch(u){c.loggingAdapter.logError(h.statuscodes.RESPONSE_PARSE_ERROR,u,b),"function"===typeof a.fail&&a.fail()}a.success(d)}}catch(u){c.loggingAdapter.logError("UrgencyErrorDone",u)}}).fail(function(e,l,d){var g=(new Date).getTime()-f;b.push("ajaxCallElapsedTime\x3d"+g);b.push("callback\x3dfail");b=b.concat(k.objToStringArray(e,"xhr-"));b.push("statusParameter\x3d"+l);b=b.concat(k.objToStringArray(d,"error-"));c.loggingAdapter.logMessage(h.statuscodes.AJAX_FAIL,b);"function"===typeof a.fail&&a.fail()})},getUTCDate:function(a){var b=new Date;a=new Date(a);return"function"!==typeof a.getMonth||isNaN(a.getMonth())?null:0<b.getTimezoneOffset()?(a.setHours(b.getHours()),a.setMinutes(b.getMinutes()),a.setSeconds(b.getSeconds()),b=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()):a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()},getUTCDateObject:function(a){var b=new Date;a=new Date(a);return"function"!==typeof a.getMonth||isNaN(a.getMonth())?null:0<b.getTimezoneOffset()?(a.setHours(b.getHours()),a.setMinutes(b.getMinutes()),a.setSeconds(b.getSeconds()),b=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())):a}},getRegionPriceCalendar:function(b,l){var e=this,k=["api\x3dRegionPriceCalendar"],f=function(a){return a&&a.regionTicker&&0!==a.regionTicker.length&&a.regionTicker[0].regionPriceCalendar?!0:!1},d=g.Deferred();b=g.extend(!0,{type:"regionpricecalendar",lob:"hotel"},b);k=k.concat(e.utils.objToStringArray(b,"request-"));e.utils.ajaxRequest({url:e.api.regionEndpoint,timeout:e.api.regionTimeout,dataType:"jsonp",data:b,success:function(b){var g;a(b,f)?g=e.statuscodes.SUCCESS_RESPONSE:(g=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.region+": "+e.statuscodes.ERROR_RESPONSE,k));d.resolve({status:g,response:b,src:l})},fail:function(){d.resolve({status:e.statuscodes.AJAX_FAIL,response:null,src:l})}},e.api.region);return d},getFlightUrgency:function(b,d){var e=this,k=["api\x3dFlightUrgency"],f,l=function(a){return a&&a.flightTicker&&0!==a.flightTicker.length&&"0"!==a.flightTicker[0].bookingCount?!0:!1},k=k.concat(e.utils.objToStringArray(b,"request-"));if("undefined"!==typeof b.startDate){f=e.utils.getUTCDate(b.startDate);if(null===f){m.publish("flightUrgency:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid StartDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.flight+": "+e.statuscodes.INVALID_INPUT,k);return}b.startDate=f}if("undefined"!==typeof b.endDate){f=e.utils.getUTCDate(b.endDate);if(null===f){m.publish("flightUrgency:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid EndDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.flight+": "+e.statuscodes.INVALID_INPUT,k);return}b.endDate=f}e.utils.ajaxRequest({url:e.api.flightEndpoint,timeout:e.api.flightTimeout,dataType:"jsonp",data:b,success:function(b){var f;a(b,l)?f=e.statuscodes.SUCCESS_RESPONSE:(f=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.flight+": "+e.statuscodes.ERROR_RESPONSE,k));m.publish("flightUrgency:arrive",{status:f,response:b,src:d})},fail:function(){m.publish("flightUrgency:arrive",{status:e.statuscodes.AJAX_FAIL,response:null,src:d})}},e.api.flight)},getHotelPriceCalendar:function(b,d){var e=this,k=["api\x3dHotelPriceCalendar"],f,l=function(a){if("undefined"===typeof a||"undefined"===typeof a.hotelTicker||0===a.hotelTicker.length)return!1;a=a.hotelTicker[0];return"undefined"===typeof a.hotelPriceCalendar||0===a.hotelPriceCalendar.length||"undefined"===typeof a.hotelPriceCalendar.datedDetails||0===a.hotelPriceCalendar.datedDetails.length?!1:!0};b=g.extend(!0,{type:"hotelpricecalendar",hpcDuration:60,lob:"hotel"},b);k=k.concat(e.utils.objToStringArray(b,"request-"));if("undefined"!==typeof b.checkInDate){f=e.utils.getUTCDate(b.checkInDate);if(null===f){m.publish("hotelPriceCalendar:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkInDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkInDate=f}if("undefined"!==typeof b.checkOutDate){f=e.utils.getUTCDate(b.checkOutDate);if(null===f){m.publish("hotelPriceCalendar:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkOutDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkOutDate=f}e.utils.ajaxRequest({url:e.api.hotelEndpoint,timeout:e.api.hotelTimeout,dataType:"jsonp",data:b,success:function(b){var f;a(b,l)?f=e.statuscodes.SUCCESS_RESPONSE:(f=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.ERROR_RESPONSE,k));m.publish("hotelPriceCalendar:arrive",{status:f,response:b,src:d})},fail:function(){m.publish("hotelPriceCalendar:arrive",{status:e.statuscodes.AJAX_FAIL,response:null,src:d})}},e.api.hotel)},getRegionCompression:function(b,d){var e=this,k=["api\x3dRegionCompression"],f=function(a){return a.regionTicker&&a.regionTicker.length&&a.regionTicker[0].regionLevelData&&a.regionTicker[0].regionLevelData.compressionSummary&&void 0!==a.regionTicker[0].regionLevelData.compressionSummary.score&&!isNaN(a.regionTicker[0].regionLevelData.compressionSummary.score)},
k=k.concat(e.utils.objToStringArray(b,"request-"));e.utils.ajaxRequest({url:e.api.regionEndpoint,timeout:e.api.regionTimeout,dataType:"jsonp",data:b,success:function(b){var g;a(b,f)?g=e.statuscodes.SUCCESS_RESPONSE:(g=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.region+": "+e.statuscodes.ERROR_RESPONSE,k));m.publish("regionCompression:arrive",{status:g,response:b,src:d})},fail:function(){m.publish("regionCompression:arrive",{status:e.statuscodes.AJAX_FAIL,response:null,src:d})}},e.api.region)},getHotelPriceTrend:function(b,d){var e=this,k=["api\x3dHotelPriceTrend"],f,l=function(a){return a&&a.hotelTicker&&0!==a.hotelTicker.length&&a.hotelTicker[0].datedPriceTrend?!0:!1};b=g.extend(!0,{type:"datedhotelpricetrends"},b);k=k.concat(e.utils.objToStringArray(b,"request-"));if("undefined"!==typeof b.checkinDate){f=e.utils.getUTCDate(b.checkinDate);if(null===f){m.publish("hotelPriceTrend:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkInDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkinDate=f}if("undefined"!==typeof b.checkoutDate){f=e.utils.getUTCDate(b.checkoutDate);if(null===f){m.publish("hotelPriceTrend:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkOutDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkoutDate=f}e.utils.ajaxRequest({url:e.api.hotelEndpoint,timeout:e.api.hotelTimeout,dataType:"jsonp",data:b,success:function(b){var f;a(b,l)?f=e.statuscodes.SUCCESS_RESPONSE:(f=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.ERROR_RESPONSE,k));m.publish("hotelPriceTrend:arrive",{status:f,response:b,src:d})},fail:function(){m.publish("hotelPriceTrend:arrive",{status:e.statuscodes.AJAX_FAIL,response:null,src:d})}},e.api.hotel)},getJustBookedRatePlan:function(b){var d=this,e=["api\x3dJustBookedRatePlan"],k=function(a){return"undefined"===typeof a||"undefined"===typeof a.hotelTicker||0===a.hotelTicker.length?!1:!0};b=g.extend(!0,{type:"lastbookedrateplan",lob:"hotel"},b);e=e.concat(d.utils.objToStringArray(b,"request-"));d.utils.ajaxRequest({url:d.api.hotelEndpoint,timeout:d.api.hotelTimeout,dataType:"jsonp",data:b,success:function(b){var f;a(b,k)?f=d.statuscodes.SUCCESS_RESPONSE:(f=d.statuscodes.ERROR_RESPONSE,e=e.concat(d.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(d.api.hotel+": "+d.statuscodes.ERROR_RESPONSE,e));m.publish("rrpJustBooked:arrive",{status:f,response:b})},fail:function(){m.publish("rrpJustBooked:arrive",{status:d.statuscodes.AJAX_FAIL,response:null})}},d.api.hotel)},getBulkHotelBookingInfo:function(b,d,e){var k=this,f="lastbooked",l=["api\x3dHotelLastBookedTime"],h=function(a){return a&&a.hotelTicker&&a.hotelTicker.length},q,r={booking:{responseValidator:function(a){return void 0!==a.hotelTicker[0].bookingsCount?!0:!1},responseExtractor:function(a){return a.hotelTicker[0].bookingsCount}},lastbooked:{responseValidator:function(a){return void 0!==a.hotelTicker[0].lastBookedTime?!0:!1},responseExtractor:function(a){return a.hotelTicker[0].lastBookedTime}}};b&&d&&(f+=",booking");b=g.extend(!0,{type:f},b);0<e&&(b=g.extend(!0,{bookingDuration:e+"h"},b));q=b.type;l=l.concat(k.utils.objToStringArray(b,"request-"));k.utils.ajaxRequest({url:k.api.hotelEndpoint,timeout:k.api.hotelTimeout,dataType:"jsonp",data:b,success:function(b){try{var f="",d,e,g=[],u=[],p=[];if(a(b,h)){for(var t,n,x=q.split(","),v=!0,w=0;w<x.length;w++)t=x[w],r.hasOwnProperty(t)&&r[t]&&(n=r[t],"function"===typeof n.responseValidator&&(v=v&&n.responseValidator(b)));if(v){f=k.statuscodes.SUCCESS_RESPONSE;d=(new Date).getTime();u=b.hotelTicker;for(e=0;e<u.length;e++)g.push({hotelId:u[e].id,elapsedTimeMillisec:d-u[e].lastBookedTime,bookingCount:u[e].bookingsCount});p=g}else f=k.statuscodes.RESPONSE_PARSE_ERROR,l=l.concat(k.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.RESPONSE_PARSE_ERROR,l)}else f=k.statuscodes.ERROR_RESPONSE,l=l.concat(k.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.ERROR_RESPONSE,l);m.publish("hotelBookingInfo:arrive",{status:f,response:p})}catch(z){c.loggingAdapter.logError("UrgencyErrorSuccess",z)}},fail:function(){m.publish("hotelBookingInfo:arrive",{status:k.statuscodes.AJAX_FAIL,response:null});c.loggingAdapter.logError("UrgencyErrorFail")}},k.api.hotel)},getHotelCompression:function(b,d){var e=this,k=["api\x3dHotelCompression"],f,l=function(a){return"undefined"===typeof a||"undefined"===typeof a.hotelTicker||0===a.hotelTicker.length||"undefined"===typeof a.hotelTicker[0].almostSoldOutData?!1:!0};b=g.extend(!0,{type:"almostsoldout"},b);if("undefined"!==typeof b.checkinDate){f=e.utils.getUTCDate(b.checkinDate);if(null===f){m.publish("hotelCompression:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkInDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkinDate=f}if("undefined"!==typeof b.checkoutDate){f=e.utils.getUTCDate(b.checkoutDate);if(null===f){m.publish("hotelCompression:arrive",{status:e.statuscodes.INVALID_INPUT+"Invalid checkOutDate",response:null,src:d});c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.INVALID_INPUT,k);return}b.checkoutDate=f}k=k.concat(e.utils.objToStringArray(b,"request-"));e.utils.ajaxRequest({url:e.api.hotelEndpoint,timeout:e.api.hotelTimeout,dataType:"jsonp",data:b,success:function(b){var f;a(b,l)?f=e.statuscodes.SUCCESS_RESPONSE:(f=e.statuscodes.ERROR_RESPONSE,k=k.concat(e.utils.objToStringArray(b,"response-")),c.loggingAdapter.logMessage(e.api.hotel+": "+e.statuscodes.ERROR_RESPONSE,k));m.publish("hotelCompression:arrive",{status:f,response:b,src:d})},fail:function(){m.publish("hotelCompression:arrive",{status:e.statuscodes.AJAX_FAIL,response:null,src:d})}},e.api.hotel)},getRegionUrgency:function(b,l,e){var k=this,f=["api\x3dRegionUrgency"],h,p,n=g.extend(!0,{},b),r={compression:{topic:"regionCompression:arrive",responseValidator:function(a){return a.regionTicker[0].regionLevelData.compressionSummary&&void 0!==a.regionTicker[0].regionLevelData.compressionSummary.score?!0:!1},responseExtractor:function(a){return{regionLevelData:a.regionTicker[0].regionLevelData,regionId:a.regionTicker[0].id}}},datedregionpricetrends:{topic:"regionPriceTrend:arrive",responseValidator:function(a){return a.regionTicker[0].datedPriceTrend.trend?!0:!1},responseExtractor:function(a){return{datedPriceTrend:a.regionTicker[0].datedPriceTrend,regionId:a.regionTicker[0].id}}},"default":{topic:"regionUrgency:arrive",responseValidator:function(a){return a&&a.regionTicker&&a.regionTicker.length},responseExtractor:function(a){return a.regionTicker}},regionview:{topic:"regionView:arrive",responseValidator:function(a){return void 0!==a.regionTicker[0].viewsCount?!0:!1},responseExtractor:function(a){return a.regionTicker[0].viewsCount}}},u=function(a){return a&&a.regionTicker&&a.regionTicker.length},f=f.concat(k.utils.objToStringArray(n,"request-"));if("undefined"!==typeof n.checkinDate){h=k.utils.getUTCDate(n.checkinDate);if(null===h){m.publish("hotelPriceTrend:arrive",{status:k.statuscodes.INVALID_INPUT+"Invalid checkInDate",response:null,src:l});c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.INVALID_INPUT,f);return}n.checkinDate=h}if("undefined"!==typeof n.checkoutDate){h=k.utils.getUTCDate(n.checkoutDate);if(null===h){m.publish("hotelPriceTrend:arrive",{status:k.statuscodes.INVALID_INPUT+"Invalid checkOutDate",response:null,src:l});c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.INVALID_INPUT,f);return}n.checkoutDate=h}p=n.type?n.type:"default";h=k.api.regionTimeout;"undefined"!==typeof n.timeout&&(h=n.timeout);k.utils.ajaxRequest({url:k.api.regionEndpoint,timeout:h,dataType:"jsonp",data:n,success:function(g){a(g,u)?!0===
e?m.publish("consolidatedRegionUrgency:arrive",{status:k.statuscodes.SUCCESS_RESPONSE,response:g,src:l,requestData:b}):d(r,p,g,l,b):(f=f.concat(k.utils.objToStringArray(g,"response-")),c.loggingAdapter.logMessage(k.api.region+": "+k.statuscodes.ERROR_RESPONSE,f),!0===e?m.publish("consolidatedRegionUrgency:arrive",{status:k.statuscodes.ERROR_RESPONSE,response:g,src:l,requestData:b}):q(p,g,l,k.statuscodes.ERROR_RESPONSE,b))},fail:function(){!0===e?m.publish("consolidatedRegionUrgency:arrive",{status:k.statuscodes.AJAX_FAIL,response:null,src:l,requestData:b}):q(p,null,l,k.statuscodes.AJAX_FAIL,b)}},k.api.region)},getHotelUrgency:function(b,g,e){var k=this,f=["api\x3dHotelUrgency"],h,l,n={"default":{topic:"hotelUrgency:arrive",responseValidator:function(a){return a&&a.hotelTicker&&a.hotelTicker.length},responseExtractor:function(a){return a.hotelTicker}},view:{topic:"hotelView:arrive",responseValidator:function(a){return void 0!==a.hotelTicker[0].viewsCount?!0:!1},responseExtractor:function(a){return a.hotelTicker[0].viewsCount}},booking:{topic:"hotelBooking:arrive",responseValidator:function(a){return void 0!==a.hotelTicker[0].bookingsCount?!0:!1},responseExtractor:function(a){return a.hotelTicker[0].bookingsCount}},lastbooked:{topic:"hotelLastBooked:arrive",responseValidator:function(a){return void 0!==a.hotelTicker[0].lastBookedTime?!0:!1},responseExtractor:function(a){return a.hotelTicker[0].lastBookedTime}}},r=function(a){return a&&a.hotelTicker&&a.hotelTicker.length},f=f.concat(k.utils.objToStringArray(b,"request-"));l=b.type?b.type:"default";if("undefined"!==typeof b.checkinDate){h=k.utils.getUTCDate(b.checkinDate);if(null===h){c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.INVALID_INPUT,f);!0===e?m.publish("consolidatedHotelUrgency:arrive",{status:k.statuscodes.INVALID_INPUT+"Invalid checkInDate",response:null,src:g,requestData:b}):q(l,null,g,k.statuscodes.INVALID_INPUT+"Invalid checkInDate",b);return}b.checkinDate=h}if("undefined"!==typeof b.checkoutDate){h=k.utils.getUTCDate(b.checkoutDate);if(null===h){c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.INVALID_INPUT,f);!0===e?m.publish("consolidatedHotelUrgency:arrive",{status:k.statuscodes.INVALID_INPUT+"Invalid checkOutDate",response:null,src:g,requestData:b}):q(l,null,g,k.statuscodes.INVALID_INPUT+"Invalid checkOutDate",b);return}b.checkoutDate=h}k.utils.ajaxRequest({url:k.api.hotelEndpoint,timeout:k.api.hotelTimeout,dataType:"jsonp",data:b,success:function(h){a(h,r)?!0===e?m.publish("consolidatedHotelUrgency:arrive",{status:k.statuscodes.SUCCESS_RESPONSE,response:h,src:g,requestData:b}):d(n,l,h,g,b):(f=f.concat(k.utils.objToStringArray(h,"response-")),c.loggingAdapter.logMessage(k.api.hotel+": "+k.statuscodes.ERROR_RESPONSE,f),!0===e?m.publish("consolidatedHotelUrgency:arrive",{status:k.statuscodes.ERROR_RESPONSE,response:h,src:g,requestData:b}):q(l,h,g,k.statuscodes.ERROR_RESPONSE,b))},fail:function(){!0===e?m.publish("consolidatedHotelUrgency:arrive",{status:k.statuscodes.AJAX_FAIL,src:g,requestData:b}):q(l,null,g,k.statuscodes.AJAX_FAIL,b)}},k.api.hotel)}};return h});(function(g){if("function"===typeof define&&define.amd)try{define("urgency/experimentUtils",["dctk/dctk"],function(m){window.urgency.experimentUtils=g(m);return window.urgency.experimentUtils})}catch(m){}else window.urgency.experimentUtils=g(window.dctk)})(function(g){return{evaluateExperiment:function(m,c){g.onReady(function(){g.evaluateExperimentAndLog({id:m,callback:function(a){a&&"undefined"===typeof a.error?c({bucketValue:a.value}):c({bucketValue:void 0})}})})},trackImpression:function(m){g.onReady(function(){g.trackImpression(m,{},"")})},logExperiment:function(m,c){g.onReady(function(){g.logExperiment({id:m,callback:function(a){a&&"undefined"===typeof a.error?c({bucketValue:a.value}):c({bucketValue:void 0})}})})}}});(function(g){try{define("urgency/notifier","jquery handlebars uitk modernizr urgency/experimentUtils animateWithCss uitk_hb_flex_card".split(" "),function(m,c,a,d,q){return g(m,c,a,d,q)})}catch(m){}})(function(g,m,c,a,d){function q(){t=!0}function h(){t=!1}function b(a){setTimeout(function(){t?b(a):a()},r.displayDuration)}function l(a){return function(b){var f=a.find(".notification-text").text();c.utils.liveAnnounce(f,"polite");a.find(".btn-close").attr("tabindex",0).on("click",function(){r.notificationClickHandler&&r.notificationClickHandler();t=!1;e(g(this).closest(".notification"))()}).on("focus",q).on("blur",h);a.css("pointer-events","auto")[n]({opacity:r.opacity},r.fadeTime,b)}}function e(a){return function(b){a.find(".btn-close").attr("tabindex",-1);a[n]({opacity:0},r.fadeTime,function(){a[n]({"min-height":0,height:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},r.fadeTime,b)})}}function k(){try{p&&(p.remove(),p=void 0)}catch(A){}}function f(a,b){var f=g.Deferred(),c={search:"people",booking:"clock",compression:"calendar",views:"people",pricetrends:"trend",event:"calendar",view:"people",lastbooked:"clock",almostsoldout:"trend"};d.evaluateExperiment(b.abacusId,function(b){if(void 0!==b.bucketValue)switch(b.bucketValue){case 1:g("body").addClass(" urgencyFlyinColor-"+b.bucketValue);r.opacity=1;g.each(a,function(a,b){"object"===typeof b&&b.hasOwnProperty("icon")&&(b.icon=null)});break;case 2:case 3:g("body").addClass(" urgencyFlyinColor-"+b.bucketValue);r.opacity=1;g.each(a,function(a,f){"object"===typeof f&&f.hasOwnProperty("type")&&(f.icon=c[f.type]+"_v"+b.bucketValue)});break;case 0:g("body").addClass(" urgencyFlyinColor-"+b.bucketValue)}f.resolve(a,b.bucketValue)});return f}var t=!1,p,n=a.csstransitions?"animateWithCss":"animate",r={displayDuration:5E3,initialWait:!0,fadeTime:750,template:"urgencynotifier",opacity:.95,insert:function(a){a.prependTo("body")}},u={template:function(){var a=m.templates,b=r.template;if(a&&b&&a[b])return a[b].apply(a,arguments);throw Error("template not implemented");},overrideConfig:function(){u.config.apply(arguments)},config:function(a){"object"===typeof a&&g.extend(r,a);return u},notify:function(){var a,d,c,m=[],u=this,n=g.Deferred(),t=n;g.each([].concat.apply([],arguments).reverse(),function(a,b){var f;(f="object"!==typeof b)||(f=b,f=Array.isArray?Array.isArray(f):"[object Array]"===Object.prototype.toString.call(f));f&&(b=g.trim(b));b&&m.push(b)});r.experiments&&r.experiments.flyinIconAsBCom&&r.experiments.flyinIconAsBCom.abacusId&&(n=n.then(function(a){return f(a,r.experiments.flyinIconAsBCom)}));n.done(function(f){p&&k();p=g(u.template({notifications:f}));r.insert(p);d=g(p.find(".notification").get().reverse());p.on("mouseenter",q).on("mouseleave",h);r.initialWait&&p.queue(b);p.queue(l(d.eq(0))).queue(b);a=0;for(c=d.length;a<c;a++)p.queue(l(d.eq(a+1))).queue(b).queue(e(d.eq(a)));p.queue(b).queue(e(d.eq(c-1))).queue(k)});t.resolve(m)}};return u});
(function(g,m){if("function"===typeof define&&define.amd)try{define("animateWithCss",["jquery"],m)}catch(c){}else m(window.jQuery)})(this,function(g){var m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)},c=/([A-Z])/g;g.fn.stopCssAnimation=function(){this.each(function(){var a=g(this),d=a.data("cssAnimatedProps"),m=window.getComputedStyle(this,null),h={},b;for(b in d)b=b.replace(c,"-$1").toLowerCase(),h[b]=m.getPropertyValue(b);a.css({"transition-property":"none","transition-duration":"","transition-timing-function":""});for(b in h)a.css(b,h[b]);a.data("cssAnimatedProps",null);if(d=a.data("cssTimeoutId"))clearTimeout(d),a.data("cssTimeoutId",null)})};g.fn.animateWithCss=function(a,d,q,h){var b=this,l=jQuery.speed(d,q,h);if(jQuery.isEmptyObject(a))return this.each(l.complete);d={bounce:"cubic-bezier(0.0, 0.35, .5, 1.3)",linear:"linear",swing:"ease-in-out"};l.easing=l.easing||"swing";l.easing=d[l.easing]?d[l.easing]:l.easing;m(function(){b.each(function(){var b=g(this);b.data("cssAnimatedProps",a);var f=window.getComputedStyle(this,null),d;for(d in a)d=d.replace(c,"-$1").toLowerCase(),b.css(d,f.getPropertyValue(d))});b.css({"transition-property":"all","transition-duration":l.duration+"ms","transition-timing-function":l.easing});b.css(a);var d=setTimeout(function(){b.css({"transition-property":"none","transition-duration":"","transition-timing-function":""});b.data("cssAnimatedProps",null);b.data("cssTimeoutId",null);jQuery.isFunction(l.complete)&&l.complete.apply(b)},l.duration);b.data("cssTimeoutId",d)});return b};return g});(function(g){try{define("hotelNotifier","jquery uitk dctk urgency/main urgency/notifier hotelNotifierConfig urgency/experimentUtils".split(" "),function(m,c,a,d,q,h,b){return g(m,c,a,d,q,h,b)})}catch(m){}})(function(g,m,c,a,d,q,h){function b(a){return a&&q&&q[a]}function l(a,b,f){var d=g.Deferred(),c;h.evaluateExperiment(f.reduceMessaging.abacusId,function(f){if(t&&void 0!==f.bucketValue){var e=new Date,e=t.getTime()-e.getTime();c=Math.floor(e/864E5);switch(f.bucketValue){case 1:0<=c&&1>=c&&(b=[]);break;case 2:0<=c&&2>=c&&(b=[]);break;case 3:0<=c&&3>=c&&(b=[])}}d.resolve(b,a,f.bucketValue)});return d}function e(a,b,d,c){var e=g.Deferred(),k=f.clientData,l=function(){var f=b[0];if(f.type)switch(f.type){case "almostsoldout":f.closeTrackAttr=k.experiments.omniturePrefix+"Compression.Close"}a.unshift(b[0])};h.evaluateExperiment(c.introduceCompression.abacusId,function(f){if(void 0!==f.bucketValue){switch(f.bucketValue){case 1:b[0].percentBooked&&60<b[0].percentBooked&&l();break;case 3:l()}h.trackImpression(k.experiments.omniturePrefix+"Compression."+b[0].percentBooked)}e.resolve(a,d,f.bucketValue)});return e}function k(a,b){var c=f.getClientExperiments(),k={experiments:c},h=g.Deferred(),m=h;f.clientData&&f.clientData.animation&&g.extend(k,f.clientData.animation);c&&c.reduceMessaging&&c.reduceMessaging.abacusId&&(h=h.then(function(a,b){return l(b,a,c)}));c&&c.introduceCompression&&c.introduceCompression.abacusId&&b&&b.length&&(h=h.then(function(a,f){return e(a,b,f,c)}));h.done(function(a,b){d.config(b).notify(a)});m.resolve(a,k)}var f={},t,p,n;f.notify=function(d){var c={};if(b(d.clientId)){f.clientData=q[d.clientId];c.clientId=d.clientId;var e;a:{e=f.clientData.requiredParams;var k=c,h,l;for(h=0;h<e.length;h++)if(l=e[h],d.hasOwnProperty(l)&&d[l])k[l]=d[l];else{e=!1;break a}e=!0}e&&(d.checkinDate&&(t=new Date(d.checkinDate)),c=g.extend(!0,f.clientData.requestParams,c),(new Date).getTime(),f.initializePromises(),f.getClientExperiments().introduceCompression||n.resolve([]),a.getHotelUrgency(c,d,!0))}};f.init=function(a){a&&a.clientId&&b(a.clientId)&&(f.clientData=q[a.clientId]);a.checkinDate&&(t=new Date(a.checkinDate))};f.getClientExperiments=function(){return f.clientData&&f.clientData.experiments?f.clientData.experiments:{}};f.createViewsMessage=function(a,b){var f,d,c=a.view.messageType;if(b.hotelTicker&&b.hotelTicker.length&&void 0!==b.hotelTicker[0].viewsCount&&1<b.hotelTicker[0].viewsCount){f=b.hotelTicker[0].viewsCount;switch(c){case "othersViewing":d={variant:c,type:"view",count:f}}return d}};f.createBookingsMessage=function(a,b){var f,d,c=a.booking.messageType;if(b.hotelTicker&&b.hotelTicker.length&&void 0!==b.hotelTicker[0].bookingsCount&&1<b.hotelTicker[0].bookingsCount){f=b.hotelTicker[0].bookingsCount;switch(c){case "othersBooked":d={type:"booking",variant:c,count:f,bookingDuration:48},m.publish("urgency.booking.message.complete",d)}return d}};f.createLastBookedMessage=function(a,b){var d,c,e;e=f.clientData;c=a.lastbooked.messageType;if(b.hotelTicker&&b.hotelTicker.length&&void 0!==b.hotelTicker[0].lastBookedTime&&"NA"!==b.hotelTicker[0].lastBookedTime){switch(c){case "recentBooking":if(!e.lastbooked.lastbookedThresholdHrs)return;c=(new Date).getTime()-b.hotelTicker[0].lastBookedTime;if(0>=c||c>36E5*e.lastbooked.lastbookedThresholdHrs)return;828E5<=c?(e=Math.ceil(c/864E5),c=1<e?"recentBookingDP":"recentBookingDS"):354E4<=c?(e=Math.ceil(c/36E5),c=1<e?"recentBookingHP":"recentBookingHS"):(e=Math.ceil(c/6E4),c=1<e?"recentBookingMP":"recentBookingMS");d={type:"lastbooked",variant:c,timeElapsed:e}}return d}};f.initializePromises=function(){n=g.Deferred();p=g.Deferred();var a=!1;require(["almostsoldouthotel"],function(b){a=!0});a||n.resolve([]);g.when.apply(g,[n,p]).then(function(a,b){(b.length||a.length)&&k(b,a)})};f.subscribeToRenderEvents=function(){var b,d,c,e,g,k,h=this;m.subscribe("consolidatedHotelUrgency:arrive",function(l,m){e=f.clientData;c=[];g=[];if(f.hasOwnProperty("clientData")){e.requestParams&&e.requestParams.type&&(c=e.requestParams.type.split(","));if(m.src&&m.status===a.statuscodes.SUCCESS_RESPONSE)for(b=0;b<c.length;b++)if(d=c[b],e[d]&&e[d].messageType){k=null;switch(d){case "view":k=h.createViewsMessage(e,m.response,m.src);break;case "booking":k=h.createBookingsMessage(e,m.response,m.src);break;case "lastbooked":k=h.createLastBookedMessage(e,m.response,m.src)}k&&g.push(k)}p.resolve(g)}});m.subscribe("hotelCompression:arrive",function(b,c){e=f.clientData;d="almostsoldout";g=[];if(f.hasOwnProperty("clientData")){if(c.src&&c.status===a.statuscodes.SUCCESS_RESPONSE&&e[d]&&e[d].messageType){var h=c.response,l,m=e.almostsoldout.messageType;if(h.hotelTicker&&h.hotelTicker.length&&h.hotelTicker[0].almostSoldOutData&&h.hotelTicker[0].almostSoldOutData.numRoomsLeftConfidence&&"NA"!==h.hotelTicker[0].almostSoldOutData.numRoomsLeftConfidence&&h.hotelTicker[0].almostSoldOutData.score&&h.hotelTicker[0].almostSoldOutData.score>e.almostsoldout.minScore&&h.hotelTicker[0].almostSoldOutData.score<e.almostsoldout.maxScore){h=h.hotelTicker[0].almostSoldOutData.score;switch(m){case "sellout_bookNow":l={type:"almostsoldout",variant:m,percentBooked:h}}k=l}else k=void 0;k&&g.push(k)}n.resolve(g)}})};f.subscribeToRenderEvents();return f});(function(){var g={hotelinfosite:{requiredParams:["ids"],requestParams:{bookingDuration:"48h",viewDuration:"30m",type:"lastbooked,view,booking"},view:{messageType:"othersViewing"},booking:{messageType:"othersBooked"},lastbooked:{messageType:"recentBooking",lastbookedThresholdHrs:"24"},almostsoldout:{messageType:"sellout_bookNow",minScore:30,maxScore:95},animation:{displayDuration:3500,initialWait:"true",fadeTime:625},experiments:{omniturePrefix:"HOT.HIS.",introduceCompression:{abacusId:"12333"},reduceMessaging:{abacusId:"12328"},flyinIconAsBCom:{abacusId:"13003"}}},test:{requiredParams:["ids"],requestParams:{bookingDuration:"48h",viewDuration:"30m",type:"lastbooked,view,booking"},view:{messageType:"othersViewing"},booking:{messageType:"othersBooked"},lastbooked:{messageType:"recentBooking",lastbookedThresholdHrs:"24"},animation:{displayDuration:3500,initialWait:"true",fadeTime:625}}};try{define("hotelNotifierConfig",function(){return g})}catch(m){}})();
require(["handlebars"],function(g){var m=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(c,a,d,g,h){var b;return(null!=(b=(d.partial||a&&a.partial||d.helperMissing).call(null!=a?a:{},"text",{name:"partial",hash:{},fn:c.program(1,h,0),inverse:c.noop,data:h}))?b:"")+"\n"+(null!=(b=c.invokePartial(g.notifier_base,a,{name:"notifier_base",data:h,helpers:d,partials:g,decorators:c.decorators}))?b:"")},1:function(c,a,d,g,h){var b;return(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.type:a,"view",{name:"urgency_if_eq",hash:{},fn:c.program(2,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.type:a,"booking",{name:"urgency_if_eq",hash:{},fn:c.program(2,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.type:a,"lastbooked",{name:"urgency_if_eq",hash:{},fn:c.program(2,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.type:a,"almostsoldout",{name:"urgency_if_eq",hash:{},fn:c.program(4,h,0),inverse:c.noop,data:h}))?b:"")},2:function(c,a,d,g,h){return"        "+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},null!=a?a.variant:a,{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotelnotifier"},data:h}))+"\n"},4:function(c,a,d,g,h){return'        \x3ch2 class\x3d"remove-margin"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"percentBooked",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotelnotifier"},data:h}))+"\x3c/h2\x3e\n        \x3cdiv\x3e"+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},null!=a?a.variant:a,{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotelnotifier"},data:h}))+"\x3c/div\x3e\n"},usePartial:!0,useData:!0});g.templates=g.templates||{};g.templates.urgencynotifier=m;g.partials=g.partials||{};g.partials.urgencynotifier=m});require(["handlebars"],function(g){var m=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(c,a,d,g,h){var b;return'\x3cdiv class\x3d"notifier"\x3e\n'+(null!=(b=d.each.call(null!=a?a:{},null!=a?a.notifications:a,{name:"each",hash:{},fn:c.program(1,h,0),inverse:c.noop,data:h}))?b:"")+"\x3c/div\x3e"},1:function(c,a,d,g,h){var b;return'        \x3cdiv class\x3d"notification uitk-grid all-col-1-1" '+(null!=(b=d["if"].call(null!=a?a:{},null!=a?a.clickTrackAttr:a,{name:"if",hash:{},fn:c.program(2,h,0),inverse:c.noop,data:h}))?b:"")+"\x3e\n"+(null!=(b=(d.uitk_flexCard||a&&a.uitk_flexCard||d.helperMissing).call(null!=a?a:{},{name:"uitk_flexCard",hash:{format:"list"},fn:c.program(4,h,0),inverse:c.noop,data:h}))?b:"")+"        \x3c/div\x3e\n"},2:function(c,a,d,g,h){var b;return"data-track\x3d"+c.escapeExpression((b=null!=(b=d.clickTrackAttr||(null!=a?a.clickTrackAttr:a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"clickTrackAttr",hash:{},data:h}):b))},4:function(c,a,d,g,h){var b;return(null!=(b=d["if"].call(null!=a?a:{},null!=a?a.icon:a,{name:"if",hash:{},fn:c.program(5,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.uitk_flexCardContent||a&&a.uitk_flexCardContent||d.helperMissing).call(null!=a?a:{},{name:"uitk_flexCardContent",hash:{contentType:"primary"},fn:c.program(8,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.uitk_flexCardContent||a&&a.uitk_flexCardContent||d.helperMissing).call(null!=a?a:{},{name:"uitk_flexCardContent",hash:{contentType:"secondary"},fn:c.program(11,h,0),inverse:c.noop,data:h}))?b:"")},5:function(c,a,d,g,h){var b;return null!=(b=(d.uitk_flexCardContent||a&&a.uitk_flexCardContent||d.helperMissing).call(null!=a?a:{},{name:"uitk_flexCardContent",hash:{contentType:"figure"},fn:c.program(6,h,0),inverse:c.noop,data:h}))?b:""},6:function(c,a,d,g,h){var b;return'                        \x3cdiv class\x3d"icon '+c.escapeExpression((b=null!=(b=d.icon||(null!=a?a.icon:a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"icon",hash:{},data:h}):b))+'"\x3e\x3c/div\x3e\n'},8:function(c,a,d,g,h){var b;return null!=(b=(d.block||a&&a.block||d.helperMissing).call(null!=a?a:{},"text",{name:"block",hash:{},fn:c.program(9,h,0),inverse:c.noop,data:h}))?b:""},9:function(c,a,d,g,h){var b;return"                        "+(null!=(b=c.lambda(a,a))?b:"")+"\n"},11:function(c,a,d,g,h){var b,l;return'                    \x3cbutton type\x3d"button" class\x3d"btn-close btn-primary" tabindex\x3d"-1" '+(null!=(b=d["if"].call(null!=a?a:{},null!=a?a.closeTrackAttr:a,{name:"if",hash:{},fn:c.program(12,h,0),inverse:c.noop,data:h}))?b:"")+'\x3e\n                        \x3cspan class\x3d"icon icon-close" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n                        \x3cspan class\x3d"alt"\x3e'+c.escapeExpression((l=null!=(l=d.closeThisMessage||(null!=a?a.closeThisMessage:a))?l:d.helperMissing,"function"===typeof l?l.call(null!=a?a:{},{name:"closeThisMessage",hash:{},data:h}):l))+"\x3c/span\x3e\n                    \x3c/button\x3e\n"},12:function(c,a,d,g,h){var b;return"data-track\x3d"+c.escapeExpression((b=null!=(b=d.closeTrackAttr||(null!=a?a.closeTrackAttr:a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"closeTrackAttr",hash:{},data:h}):b))},useData:!0});g.templates=g.templates||{};g.templates.notifier_base=m;g.partials=g.partials||{};g.partials.notifier_base=m});(function(){var g={hotelinfosite:{requiredParams:["ids","checkinDate","checkoutDate"],requestParams:{type:"almostsoldout"},messageType:"price_hike",minCompressionScore:30,maxCompressionScore:95,experiments:{optimizeCompression:{abacusId:"12333"}}}};try{define("almostsoldouthotelConfig",function(){return g})}catch(m){}})();
require(["handlebars"],function(g){var m=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(c,a,d,g,h){var b,l;return'\x3cdiv class\x3d"compressionAlert graphic" id\x3d"hotelCompressionAlert"\x3e\n    \x3cdiv class\x3d"scorebox"\x3e\n        \x3cdiv aria-hidden\x3d"true" class\x3d"text score"\x3e'+c.escapeExpression((l=null!=(l=d.score||(null!=a?a.score:a))?l:d.helperMissing,"function"===typeof l?l.call(null!=a?a:{},{name:"score",hash:{},data:h}):l))+'\x3cspan class\x3d"sign"\x3e%\x3c/span\x3e\x3c/div\x3e\n        \x3cdiv aria-hidden\x3d"true" class\x3d"text description"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"booked",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+'\x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"alert alert-info"\x3e\n        \x3ch5 class\x3d"alert-message" role\x3d"alert"\x3e\n'+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.message:a,"popular_dates",{name:"urgency_if_eq",hash:{},fn:c.program(1,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.message:a,"price_hike",{name:"urgency_if_eq",hash:{},fn:c.program(3,h,0),inverse:c.noop,data:h}))?b:"")+'        \x3c/h5\x3e\n        \x3cbutton type\x3d"button" data-control\x3d"remove" data-track\x3d'+c.escapeExpression((l=null!=(l=d.closeTrack||(null!=a?a.closeTrack:a))?l:d.helperMissing,"function"===typeof l?l.call(null!=a?a:{},{name:"closeTrack",hash:{},data:h}):l))+' data-target-id\x3d"hotelCompressionAlert" class\x3d"btn-primary btn-close"\x3e\n            \x3cspan class\x3d"icon icon-close" aria-hidden\x3d"true"\x3e\x3c/span\x3e\x3cspan class\x3d"alt"\x3eclose\x3c/span\x3e\n        \x3c/button\x3e\n    \x3c/div\x3e\n\x3c/div\x3e'},1:function(c,a,d,g,h){return'                \x3cspan class\x3d"title"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"popular_dates",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+'\x3c/span\x3e\n                \x3cspan class\x3d"linewrap"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"book_soon",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+"\x3c/span\x3e\n"},3:function(c,a,d,g,h){return'                \x3cspan class\x3d"title"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"sellout",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+'\x3c/span\x3e\n                \x3cspan class\x3d"linewrap"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"price_hike",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+"\x3c/span\x3e\n"},useData:!0});g.templates=g.templates||{};g.templates.almostsoldoutalert_graphic=m;g.partials=g.partials||{};g.partials.almostsoldoutalert_graphic=m});require(["handlebars"],function(g){var m=g.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(c,a,d,g,h){var b,l;return'\x3cdiv class\x3d"alert alert-info compressionAlert text" id\x3d"hotelCompressionAlert"\x3e\n    \x3ch5 class\x3d"alert-message" role\x3d"alert"\x3e\n'+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.message:a,"popular_dates",{name:"urgency_if_eq",hash:{},fn:c.program(1,h,0),inverse:c.noop,data:h}))?b:"")+(null!=(b=(d.urgency_if_eq||a&&a.urgency_if_eq||d.helperMissing).call(null!=a?a:{},null!=a?a.message:a,"price_hike",{name:"urgency_if_eq",hash:{},fn:c.program(3,h,0),inverse:c.noop,data:h}))?b:"")+'    \x3c/h5\x3e\n    \x3cbutton type\x3d"button" data-control\x3d"remove" data-track\x3d'+c.escapeExpression((l=null!=(l=d.closeTrack||(null!=a?a.closeTrack:a))?l:d.helperMissing,"function"===typeof l?l.call(null!=a?a:{},{name:"closeTrack",hash:{},data:h}):l))+' data-target-id\x3d"hotelCompressionAlert" class\x3d"btn-primary btn-close"\x3e\n    \x3cspan class\x3d"icon icon-close" aria-hidden\x3d"true"\x3e\x3c/span\x3e\x3cspan class\x3d"alt"\x3eclose\x3c/span\x3e\n    \x3c/button\x3e\n\x3c/div\x3e'},1:function(c,a,d,g,h){return'            \x3cspan class\x3d"title"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"rooms_booked",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"linewrap"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"popular_dates",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+"\x26nbsp;"+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"book_soon",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+"\x3c/span\x3e\n"},3:function(c,a,d,g,h){return'            \x3cspan class\x3d"title"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"rooms_booked",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"linewrap"\x3e'+c.escapeExpression((d.urgency_loc||a&&a.urgency_loc||d.helperMissing).call(null!=a?a:{},"price_hike",{name:"urgency_loc",hash:{bundle:"views_default_pages_shared_urgency_hotel"},data:h}))+"\x3c/span\x3e\n"},useData:!0});g.templates=g.templates||{};g.templates.almostsoldoutalert=m;g.partials=g.partials||{};g.partials.almostsoldoutalert=m});
(function(g){try{define("almostsoldouthotel","jquery uitk dctk urgency/main almostsoldouthotelConfig handlebars urgency/experimentUtils".split(" "),function(m,c,a,d,q,h,b){return g(m,c,a,d,q,h,b)})}catch(m){}})(function(g,m,c,a,d,q,h){function b(a){return a&&d&&d[a]}function l(a){var b=k.clientData.minCompressionScore||60,c=k.clientData.maxCompressionScore||95;return a.hotelTicker&&a.hotelTicker.length&&a.hotelTicker[0].almostSoldOutData&&a.hotelTicker[0].almostSoldOutData.numRoomsLeftConfidence&&"NA"!==a.hotelTicker[0].almostSoldOutData.numRoomsLeftConfidence&&a.hotelTicker[0].almostSoldOutData.score&&a.hotelTicker[0].almostSoldOutData.score>b&&a.hotelTicker[0].almostSoldOutData.score<c}function e(a,b){var c=g.Deferred();h.evaluateExperiment(b.optimizeCompression.abacusId,function(b){if(void 0!==b.bucketValue)switch(b.bucketValue){case 0:a.score&&60<a.score&&c.resolve(a,b.bucketValue);break;case 1:case 3:a=void 0;c.resolve(a,b.bucketValue);break;case 2:c.resolve(a,b.bucketValue)}else a.score&&60<a.score&&c.resolve(a,b.bucketValue)});return c}var k={init:function(a){a&&a.clientId&&b(a.clientId)&&(k.clientData=d[a.clientId])},showAlert:function(c){var e={},f;f=c?!(c.hasOwnProperty("ids")&&c.hasOwnProperty("checkinDate")&&c.hasOwnProperty("checkoutDate")&&c.hasOwnProperty("clientcontainer")&&c.hasOwnProperty("clientId"))||c.clientcontainer instanceof g&&0===c.clientcontainer.length?!1:!0:!1;if(!f)console.log("invalid request");else if(b(c.clientId)){k.clientData=d[c.clientId];e.clientId=c.clientId;a:{f=k.clientData.requiredParams;var h=e,l,m;for(l=0;l<f.length;l++)if(m=f[l],c.hasOwnProperty(m)&&c[m])h[m]=c[m];else{f=!1;break a}f=!0}f&&(e=g.extend(!0,k.clientData.requestParams,e),a.getHotelCompression(e,c))}},subscribeToRenderEvents:function(){var b;m.subscribe("hotelCompression:arrive",function(d,f){var h,m,p,t=g.Deferred(),y=t;if(k.hasOwnProperty("clientData")&&f&&f.status&&f.status===a.statuscodes.SUCCESS_RESPONSE){if(!f.src||!f.src.clientcontainer)return c.loggingAdapter.logMessage(a.api.hotel+": "+self.statuscodes.INVALID_INPUT,"No clientcontainer provided"),!1;l(f.response)&&(h=f.response.hotelTicker[0].almostSoldOutData,m=k.clientData.messageType||"price_hike",(b=k.clientData&&k.clientData.experiments?k.clientData.experiments:{})&&b.optimizeCompression&&b.optimizeCompression.abacusId&&(t=t.then(function(a){return e(a,b)})),t.done(function(a){a&&(p=q.templates.almostsoldoutalert_graphic({score:a.score,message:m,closeTrack:"HOT.HIS.Compression.Close"}),f.src.clientcontainer.append(p))}),y.resolve(h))}})}};g(function(){k.subscribeToRenderEvents()});return k});
//# sourceMappingURL=infositeurgencyscripts.js.map